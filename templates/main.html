<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel=stylesheet type=text/css
          href="{{ url_for('static', filename='bootstrap.min.css') }}">
    <link rel=stylesheet type=text/css
          href="{{ url_for('static', filename='style.css') }}?234">
    <script src="{{ url_for('static', filename='jquery-3.3.1.min.js') }}"></script>
    <script src="{{ url_for('static', filename='bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='myjscript.js') }}?3"></script>
    <title>Scan Phone for IPS apps</title>
    <script>

        var device = "{{ device }}";
        var serial = "{{ serial }}";
        var scanid = "{{ scanid }}";
        var clientid = "{{ clientid }}";
     
        function report_success(m) {
            $('#msg').html(m);
            $('#msg').prop('class', 'alert alert-success')
        }

        function report_failure(m) {
            $('#msg').html(m);
            $('#msg').prop('class', 'alert alert-warning')
        }

        function postform(form1) {
            // $(form1).prop('disabled', true);
            d1 = $('#form-metainfo').serialize();
            d2 = $('#form-applist').serialize();
            $.post('/saveapps/' + scanid, data=d2);
            $.post('/savescan/' + scanid, data = d1).done(function (r) {
                report_success(r)
                $('#btn-submit').prop('disabled', false);
            }).fail(function (r) {
                report_failure(r.responseText)
            });
            return false;
        }

     function reset_form(form) {
         if (confirm("Do you want to reset the form?")) {
             window.location.href = "/";
         }
     }
        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip();
            $('input[type="text"]').on('keyup keypress', function (e) {
                var keyCode = e.keyCode || e.which;
                if (keyCode === 13) {
                    e.preventDefault();
                    return false;
                }
            });
            $('#btn-submit').prop('disabled', true);
            $('#applist > tr > td > input').focusout(function (e) {
                data = {'appId': e.target.name, 'serial': serial, 'note': e.target.value}
                $.post('/save/appnote/' + device, data = data).done(success = function (r) {
                    report_success("Note saved.")
                });
            })
        });
    </script>
</head>

<body class="container-fluid">
<div class="">
    <h4><span style="color: green; font-family: monospace; font-size: 0.3in">PhoneScanner:</span>
        Scan phones for IPS apps</h4>
    <p>This application scans an Android and iOS phone for apps that can be used to spy,
        track, or monitor on a person without their knowledge.
	
        <!-- <form id="kill-server" method="POST" action="/kill" name="form-kill">
	     <button value="submit" class="btn btn-primary mx-2">Close App</button>
	     </form> -->
	<a href="/kill" onclick="window.open('','_self').close();">Close App</a>
    </p>
</div>
<div class="row  h-100">
    <div class="col-md-3 border py-2" style="height:80vh;">
        <div align="center">
            <label class="font-weight-bold lead">Scan</label>
            <form id="scan_select" method="GET" action="/scan">
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
		    {% for a in ["Android", "iOS", "Test"] %}
                    <label class="btn btn-secondary {% if device==a.lower() %} active {% endif %}">
                        <input type="radio" name="device" id="{{ a | lower }}"
			       value="{{ a| lower }}" autocomplete="off"
			       {% if device==a.lower() %} checked {% endif %}
			> {{ a }}
                    </label>
		    {% endfor %}
                    <!-- <label class="btn btn-secondary">
                         <input type="radio" name="device" id="android" value="android" autocomplete="off"> Android
			 </label>
			 <label class="btn btn-secondary">
                         <input type="radio" name="device" id="ios" value="ios" autocomplete="off"> iOS
			 </label>
			 <label class="btn btn-secondary">
                         <input type="radio" name="device" id="test" value="test" autocomplete="off"> Test
			 </label> -->
                </div>
                <label><b>Client ID</b>
                <input class="form-control col-sm-10 col-md-10" name="clientid" id="client-id" type="text" value="{{ clientid }}"/></label>
                <button class="btn btn-primary mx-2">Scan</button>
            </form>
            {% for t in ["Android", "iOS", "test"] %}
                <!-- button onclick="fetch('/scan/{{ t.lower() }}', '{{ t.lower() }}')" id="btn-android"
                            class="btn btn-primary mx-2">{{ t }}</button -->
            {% endfor %}
            <hr/>
        </div>
        <div class="border-warning visible">
            <form onsubmit="return false" name="form-metainfo" id="form-metainfo">
                <label> Phone Serial No:</label>
		<input class="form-control" name="serial" id="serial" type="text" placeholder="Device Id"
                                     value="{{ serial }}" readonly>
                 <input type="hidden" name="clientid" type="text" value="{{ clientid }}"/></label>
                <textarea class="form-control " name="notes" id="notes" type="text" placeholder="Take notes here."
                          rows="10" {% if not serial %}disabled{% endif %}></textarea>
                <button onclick="postform(this)" id="btn-metainfo-submit"
                        class="btn btn-primary btn-lg my-3">Save
                </button>
                <button onclick="reset_form(this)" id="btn-metainfo-reset"
                        class="btn btn-outline-warning btn-lg my-3">Reset
                </button>
            </form>
        </div>
    </div>
    <div class="col-md-9 border py-2" style="height: 80vh">
        <div id="msg" class="alert alert-primary" style="">  {{ error | safe }}   </div>
        <div class="w-100" style="height: 70vh; overflow: auto;">
	    <label>Jailbroken/Rooted: <b>{{ isrooted }}</b></label>
            <table class="table table-bordered w-100 h-100">
                <thead>
                <tr>
                    <th style="width: 3%">Delete</th>
                    <th style="width: 23%">App Name</th>
                    <th style="width: 23%">App ID</th>
                    <th style="width: 20%">Flags</th>
                    <th style="width: 30%">Remarks</th>
                </tr>
                </thead>
                <form id="form-applist" onsubmit="" method="post" name="form-applist" >
                    <tbody id="applist" class="h-100">
                        {% for appId, info in apps.items() %}
                        <tr id="{{ appId.replace('.', '-') }}">
                            {% if appId in sysapps %}
                            <td align="center" ><a class="h4" onclick="" href="javascript:;" data-toggle="tooltip"
                                   title="System App! Cannot delete">&otimes;</a></td>
                            {%  else %}
                            <td align="center"><a class="h4" onclick="delete_app('{{ appId }}', this)" href="javascript:;" data-toggle="tooltip"
                                   title="Delete app">&otimes;</a></td>
                            {% endif %}
                            {% if info['title'] %}
                            <td><a href="/details/app/{{ device }}?appId={{ appId }}&serial={{ serial }}" target="_blank"
				class="text text-dark">{{ info['title'] }}</a></td>
                            {% else %}
  <td><a href="/details/app/{{ device }}?appId={{ appId }}&serial={{ serial }}" target="_blank"
  class="text text-dark">Unnamed</a></td>


                            {% endif %}
                            <td><a class="{{ info.class_ }} appid" href="https://www.google.com/search?q={{ appId }}"
                                   target="_blank"><code>{{ appId }}</code></a></td>
                            <td>{{ info['html_flags'] | safe }}</td>
                            <td><input type="text" placeholder="Remarks" class='form-control appnotes' name="{{ appId }}" /></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </form>
            </table>
            <!-- <button onclick="postform(this)" id="btn-submit"
                     class="btn btn-primary btn-lg">Submit</button> -->
        </div>
        <div class="progress">
            <div id='scan-prog' class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                 aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
            </div>
        </div>
    </div>
</div>
</body>
</html>
